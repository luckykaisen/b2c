<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper SYSTEM "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.atguigu.dao.SearchMapper">
	
	 <select id="select_sku_by_class_2" resultMap="select_sku_by_class_2_map"
		parameterType="int">
	select sku.id as sku_id,spu.id as spu_id,tm.id as tm_id
		,sku.*,spu.*,tm.*
		from
		T_mall_product spu,
		T_mall_sku sku,
		T_mall_sku_attr_value av,
		T_mall_trade_mark tm,
		T_mall_tm_class tmc,
		t_mall_value val,
		t_mall_attr attr

		where spu.Id =sku.shp_id AND
		sku.Id = av.sku_id AND
		spu.flbh1 =
		tmc.flbh1 AND
		tmc.pp_id = tm.Id and
		spu.pp_id = tm.id
		and	spu.flbh2 = attr.flbh2
		and attr.Id = val.shxm_id
		and spu.flbh2 = #{flbh2}
		${sql}
	
	</select>

	<resultMap type="com.atguigu.bean.OBJECT_T_MALL_SKU" id="select_sku_by_class_2_map"
		autoMapping="true">
		<result column="sku_id" property="id" />
		<association javaType="com.atguigu.bean.T_MALL_PRODUCT"
			property="spu" autoMapping="true">
			<result column="spu_id" property="id" />
		</association>
		<association javaType="com.atguigu.bean.T_MALL_TRADE_MARK"
			property="tm" autoMapping="true">
			<result column="tm_id" property="id" />
		</association>
	</resultMap>
	
	
	<select id="select_attr_by_class_2_id" resultMap="select_attr_by_class_2_id_map">
		select attr.id as attr_id , val.id as val_id, attr.* , val.* 
		from t_mall_attr attr , t_mall_value val 
		where attr.Id = val.shxm_id
		and flbh2 = #{id}
	</select>
	
	<resultMap type="com.atguigu.bean.OBJECT_T_MALL_ATTR" id="select_attr_by_class_2_id_map" autoMapping="true">
		<result column="attr_id" property="id"/>
		<collection property="list_value" ofType="com.atguigu.bean.T_MALL_VALUE" autoMapping="true">
			<result column="val_id" property="id"/>
		</collection>
	</resultMap>
	
	<select id="select_commodity_info" resultMap="select_commodity_info_map">
			select
			spu.id as spu_id , spu.*,
			sku.id as sku_id ,sku.*,
			img.id as img_id ,img.*,
			CONCAT(attr.shxm_mch ,val.shxzh,val.shxzh_mch) as attr_val
			from 
			t_mall_product spu,
			t_mall_attr attr ,
			t_mall_value val ,
			 t_mall_sku sku ,
			t_mall_sku_attr_value av,
			t_mall_product_image img
			where
			sku.shp_id = spu.Id
			AND
			sku.Id = av.sku_id
			and
			av.shxm_id = attr.id
			and
			av.shxzh_id = val.id
			and
			spu.id = img.shp_id
			and
			sku.id = #{sku_id}		
	</select>
	
	<resultMap type="com.atguigu.bean.MODEL_MALL_OBJECT_T_MALL_SPU_SKU" id="select_commodity_info_map" autoMapping="true">
		<result column="sku_id" property="id"/>
		<association property="t_mall_product" javaType="com.atguigu.bean.T_MALL_PRODUCT" autoMapping="true">
			<result column="spu_id" property="id" />
		</association>
		<collection property="list_image" ofType="com.atguigu.bean.T_MALL_PRODUCT_IMAGE" autoMapping="true">
			<result column="img_id" property="id"/>
		</collection>
		<collection property="t_mall_attr_value_name" ofType="com.atguigu.bean.T_MALL_ATTR_VALUE_NAME" autoMapping="true"></collection>
	</resultMap>	
	
	<!-- 查询商品的兄弟商品 -->
	<select id="select_commodity_info_by_sibling" resultType="com.atguigu.bean.T_MALL_SKU">
		select * from t_mall_sku where shp_id = #{spu_id}
	</select>
		
</mapper>
